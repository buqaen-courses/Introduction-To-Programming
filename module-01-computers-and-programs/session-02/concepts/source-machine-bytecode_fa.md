# کد منبع، کد ماشین و بایت‌کد: سطوح کد

## به زبان ساده

**چه چیزی یاد می‌گیرید:** برنامه‌ها در سطوح مختلفی از انتزاع وجود دارند—از کدی که انسان‌ها می‌نویسند تا صفر و یک‌هایی که کامپیوتر می‌فهمد. این مقاله سه سطح اصلی کد (منبع، بایت‌کد، ماشین) را توضیح می‌دهد و نشان می‌دهد چگونه زبان‌های مختلف بین این سطوح حرکت می‌کنند.

**نکته برای تازه‌کاران:** این سطوح را مانند زبان‌ها در نظر بگیرید:
- کد منبع = زبان مادری شما (انگلیسی/فارسی)
- بایت‌کد = زبان میانی (Esperanto)
- کد ماشین = زبان بومی کشور (ژاپنی، فرانسوی)

---

## سه سطح کد

```
┌─────────────────────────────────────────────────────────────────────┐
│                    سطوح انتزاع کد                                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  سطح بالا (انسان‌پسند)                                               │
│  ═════════════════════════════════════════════════════════==         │
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  کد منبع (Source Code)                                        │   │
│  │  • قابل خواندن توسط انسان                                      │   │
│  │  • زبان برنامه‌نویسی سطح بالا                                 │   │
│  │  • مثال: Python، C++، JavaScript                              │   │
│  │                                                              │   │
│  │  def calculate_area(length, width):                           │   │
│  │      return length * width                                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                       │
│                              ▼                                       │
│  سطح میانی (قابل حمل)                                                │
│  ═════════════════════════════════════════════════════════==         │
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  بایت‌کد (Bytecode)                                           │   │
│  │  • کد ماشین مجازی                                              │   │
│  │  • مستقل از پلتفرم واقعی                                     │   │
│  │  • مثال: Python bytecode، Java bytecode، .NET IL             │   │
│  │                                                              │   │
│  │   ۲ LOAD_CONST     ۱ (۵)                                     │   │
│  │   ۴ STORE_FAST     ۰ (length)                                 │   │
│  │   ۶ LOAD_CONST     ۲ (۱۰)                                     │   │
│  │   ۸ STORE_FAST     ۱ (width)                                  │   │
│  │  ۱۰ LOAD_FAST      ۰ (length)                                 │   │
│  │  ۱۲ LOAD_FAST      ۱ (width)                                  │   │
│  │  ۱۴ BINARY_MULTIPLY                                           │   │
│  │  ۱۶ RETURN_VALUE                                                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                       │
│                              ▼                                       │
│  سطح پایین (ماشین)                                                   │
│  ═════════════════════════════════════════════════════════==         │
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  کد ماشین (Machine Code)                                      │   │
│  │  • باینری خام (۰ و ۱)                                          │   │
│  │  • اجرا مستقیم توسط CPU                                       │   │
│  │  • خاص به معماری (x86، ARM)                                   │   │
│  │                                                              │   │
│  │  10110000 01100001  (mov eax, 0x61)                          │   │
│  │  00000001 11000011  (add eax, ebx)                          │   │
│  │  11000011            (ret)                                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## کد منبع (Source Code)

**کد منبع** کدی است که برنامه‌نویسان می‌نویسند—قابل خواندن توسط انسان.

### ویژگی‌ها:
- قابل خواندن و درک توسط انسان
- نحو سطح بالا (متغیرها، توابع، کلاس‌ها)
- کامنت و مستندات
- نیاز به ترجمه (کامپایل/تفسیر)

### مثال‌ها:

```python
# کد منبع پایتون
def greet(name):
    """سلام به کاربر می‌دهد"""
    message = f"سلام، {name}!"
    print(message)
    return message
```

```cpp
// کد منبع C++
int add(int a, int b) {
    // جمع دو عدد صحیح
    return a + b;
}
```

```javascript
// کد منبع JavaScript
function calculateSum(numbers) {
    return numbers.reduce((sum, num) => sum + num, 0);
}
```

---

## بایت‌کد (Bytecode)

**بایت‌کد** یک فرمت میانی است—کد ماشین برای یک ماشین مجازی.

### ویژگی‌ها:
- کد ماشین مجازی (نه CPU واقعی)
- مستقل از پلتفرم سخت‌افزاری
- فشرده‌تر از کد منبع
- نیاز به ماشین مجازی برای اجرا

### مثال بایت‌کد پایتون:

```python
# کد منبع
x = 5
y = 10
result = x + y
```

```
# بایت‌کد معادل (disassembly)
  ۲           ۰ LOAD_CONST     ۱ (۵)
  ۲           ۲ STORE_NAME     ۰ (x)

  ۳           ۴ LOAD_CONST     ۲ (۱۰)
  ۳           ۶ STORE_NAME     ۱ (y)

  ۴           ۸ LOAD_NAME      ۰ (x)
  ۴          ۱۰ LOAD_NAME      ۱ (y)
  ۴          ۱۲ BINARY_ADD
  ۴          ۱۴ STORE_NAME     ۲ (result)
  ۴          ۱۶ LOAD_CONST     ۳ (None)
  ۴          ۱۸ RETURN_VALUE
```

### زبان‌هایی که از بایت‌کد استفاده می‌کنند:

| زبان | بایت‌کد | ماشین مجازی |
|------|---------|-------------|
| **Python** | `.pyc` | CPython VM |
| **Java** | `.class` | JVM |
| **C#** | `.dll/.exe` | CLR |
| **Ruby** | YARV bytecode | YARV |

---

## کد ماشین (Machine Code)

**کد ماشین** دستورالعمل‌های باینری است که CPU مستقیماً اجرا می‌کند.

### ویژگی‌ها:
- باینری خام (۰ و ۱)
- اجرای مستقیم توسط CPU
- خاص به معماری (x86، ARM، MIPS)
- سریع‌ترین سطح اجرا
- غیرقابل حمل بین پلتفرم‌ها

### مثال کد ماشین (x86-64):

```
; کد ماشین برای: return 42

باینری:        هگز:           اسمبلی:
10110000       B0 2A          mov al, 42      ; 42 را در ثبات AL بگذار
00101010       
11000011       C3             ret             ; بازگشت
```

### مقایسه معماری‌ها:

| معماری | شرکت سازنده | استفاده اصلی |
|--------|-------------|--------------|
| **x86-64** | Intel/AMD | دسکتاپ، لپ‌تاپ، سرور |
| **ARM** | ARM Holdings | گوشی، تبلت، IoT |
| **RISC-V** | متن‌باز | آموزش، embedded |
| **MIPS** | MIPS Technologies | روتر، کنسول بازی قدیم |

---

## نحوه تبدیل بین سطوح

```
┌─────────────────────────────────────────────────────────────────────┐
│                    مسیر تبدیل کد                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  زبان کامپایل شده (C++):                                             │
│  ═════════════════════════════════════════════════════════==         │
│                                                                      │
│  کد منبع ──[کامپایلر]──> کد ماشین ──[اجرا]──> نتیجه                 │
│   (.cpp)       (clang)      (.exe)      (CPU)                        │
│                                                                      │
│  ─────────────────────────────────────────────────────────────       │
│                                                                      │
│  زبان با بایت‌کد (Python، Java):                                      │
│  ═════════════════════════════════════════════════════════==         │
│                                                                      │
│  کد منبع ──[کامپایلر]──> بایت‌کد ──[ماشین مجازی]──> نتیجه            │
│   (.py)       (python)     (.pyc)      (PVM/JVM)                     │
│                                                                      │
│  ─────────────────────────────────────────────────────────────       │
│                                                                      │
│  زبان با JIT (JavaScript V8):                                         │
│  ═════════════════════════════════════════════════════════==         │
│                                                                      │
│  کد منبع ──[تجزیه]──> AST ──[JIT]──> کد ماشین ──[اجرا]──> نتیجه      │
│   (.js)       (parser)            (V8)         (CPU)                 │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## مقایسه جامع

| ویژگی | کد منبع | بایت‌کد | کد ماشین |
|---------|---------|---------|----------|
| **قابل خواندن** | انسان | ماشین مجازی | CPU |
| **حجم** | بزرگ | متوسط | کوچک |
| **سرعت اجرا** | نیاز به ترجمه | نیاز به تفسیر | فوری |
| **قابلیت حمل** | عالی (با مفسر) | خوب (با VM) | ضعیف (خاص CPU) |
| **اشکال‌زدایی** | آسان | سخت‌تر | خیلی سخت |
| **مثال** | `x = 5` | `LOAD_CONST 5` | `10110000 00000101` |

---

## چرا این سطوح مهم هستند؟

### مزایای جداسازی سطوح:

۱. **قابلیت حمل:**
   - کد منبع → هر جا با مفسر
   - بایت‌کد → هر جا با ماشین مجازی
   - بدون نیاز به کامپایل مجدد برای هر CPU

۲. **امنیت:**
   - توزیع بایت‌کد به جای کد منبع
   - کد ماشین حتی سخت‌تر قابل برگشت است

۳. **بهینه‌سازی:**
   - هر سطح می‌تواند بهینه شود
   - بایت‌کد بهتر از کد منبع بهینه می‌شود
   - کد ماشین بهترین عملکرد را دارد

۴. **توسعه:**
   - برنامه‌نویسان روی کد منبع کار می‌کنند
   - ماشین مجازی پیچیدگی سخت‌افزار را پنهان می‌کند

---

## نکات کلیدی

۱. **کد منبع** → قابل خواندن توسط انسان، نیاز به ترجمه
۲. **بایت‌کد** → کد ماشین مجازی، مستقل از پلتفرم
۳. **کد ماشین** → باینری CPU، اجرای مستقیم

۴. **Python:**
   - کد منبع → بایت‌کد (کامپایل خودکار)
   - بایت‌کد → PVM (اجرا)

۵. **C++:**
   - کد منبع → کد ماشین (کامپایل ahead-of-time)
   - کد ماشین → اجرای مستقیم

۶. **Java:**
   - کد منبع → بایت‌کد (کامپایل)
   - بایت‌کد → JVM (تفسیر یا JIT)
